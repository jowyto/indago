<?php



/**
 * Skeleton subclass for representing a row from the 'dataset' table.
 *
 *
 *
 * This class was autogenerated by Propel 1.6.7 on:
 *
 * Sat Dec 14 11:40:59 2013
 *
 * You should add additional methods to this class to meet the
 * application requirements.  This class will only be generated as
 * long as it does not already exist in the output directory.
 *
 * @package    propel.generator.lib.model
 */
class Dataset extends BaseDataset
{
	public function __toString(){
		return $this->getDataset();
	}

	public function getValoracion(){
		$vals = $this->getDatasetValoracions();
		if($vals->count()) return $vals[0];
		return new DatasetValoracion();
	}

	public function save(PropelPDO $con = null){
		parent::save($con);

		// guardar en elastic
		$datasets = DatasetQuery::create()->find();
		$elastic = sfElasticSearch::getInstance();
		
		if(!$elastic->getStatus()->indexExists('datasets'))
			$index = $elastic->getIndex('datasets')->create();
		else{
			$index = $elastic->getIndex('datasets');
		}
		$type = $index->getType('dataset');

		$doc = new Elastica_Document($dataset->getId(), $dataset->toArray());
		$type->addDocument($doc);
		$index->refresh();
	}
}
